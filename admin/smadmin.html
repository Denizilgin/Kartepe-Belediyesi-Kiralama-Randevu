<!doctype html>
<html lang="en">
  <head>
  	<title>Sandalye-Masa Admin Paneli</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,700' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	
	<link rel="stylesheet" href="css/style.css"> 
	<style>
		tr:not(:last-child) {
		  border-bottom: 1px solid #ccc; /* Çizgi rengi ve kalınlığını istediğiniz gibi düzenleyebilirsiniz */
		}</style>

	</head>
	<body>
    <h3 style = "text-align: center;">ÖDEMESİ YAPILMIŞ AKTİF İŞLEMLER</h3>
		<div class="row">
			<div class="col-md-12">
				<div class="table-wrap">
					<table class="table table-dark" id = "data-table">
					  <thead>
						<tr class="bg-dark">
						  <th>Müşteri</th>
						  <th>TC</th>
						  <th>Telefon</th>
						  <th>Ödenen Fiyat</th>
              <th>İstenen Sandalye</th>
              <th>İstenen Masa</th>
						  <th>Adres</th>
						</tr>
					  </thead>
					  <tbody id="table-body">
						<!--Veriler-->
					  </tbody>
					</table>	
				</div>
			</div>
		</div>
 <h3 style = "text-align: center;">GERİ ALIM ONAY</h3>
 <!--GERİ ALMA TABLOSU-->
		<div class="row">
			<div class="col-md-12">
				<div class="table-wrap">
					<table class="table table-dark" id = "data-table">
					  <thead>
						<tr class="bg-dark">
						  <th>Müşteri</th>
              <th>Sandalye</th>
              <th>Masa</th>
              <th>Geri Alınan Masa</th>
              <th>Geri Alınan Sandalye</th>
						  <th>Geri Al</th>
						</tr>
					  </thead>
					  <tbody id="table-body2">
						<!--Veriler-->
					  </tbody>
					</table>	
				</div>
			</div>
		</div>
    <h3 style = "text-align: center;">ÖDEMESİ YAPILMAMIŞ İŞLEMLER</h3>
 <!--ÖDEMESİ YAPILMAYANLAR-->
		<div class="row">
			<div class="col-md-12">
				<div class="table-wrap">
					<table class="table table-dark" id = "data-table">
					  <thead>
						<tr class="bg-dark">
						  <th>Müşteri</th>
						  <th>TC</th>
						  <th>Telefon</th>
						  <th>Ödenen Fiyat</th>
              <th>İstenen Sandalye</th>
              <th>İstenen Masa</th>
						  <th>Adres</th>
						</tr>
					  </thead>
					  <tbody id="table-body4">
						<!--Veriler-->
					  </tbody>
					</table>	
				</div>
			</div>
		</div>
    <h3 style = "text-align: center;">GEÇMİŞ İŞLEMLER</h3>
    <!--GEÇMİŞ İŞLEMLER TABLOSU-->
    <div class="row">
			<div class="col-md-12">
				<div class="table-wrap">
					<table class="table table-dark" id = "data-table">
					  <thead>
						<tr class="bg-dark">
						  <th>Müşteri</th>
						  <th>TC</th>
						  <th>Telefon</th>
						  <th>Ödenen Fiyat</th>
						  <th>İstenen Sandalye</th>
						  <th>İstenen Masa</th>
						  <th>Adres</th>
						</tr>
					  </thead>
					  <tbody id="table-body3">
						<!--Veriler-->
					  </tbody>
					</table>	
				</div>
			</div>
		</div>
    <div class="thirdPart" style="height: 350px;">
      <div class="info-box">
        <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
          <div class="col p-4 d-flex flex-column position-static">
            <div class="row mb-3 text-center">
              <div class="col-md-3 themed-grid-col">
                <p id="adetValue" style="color: rgb(0, 0, 0); font-size: 16px;"></p>
                <h6>Güncellenmek istenen sayı:</h6>
                  <input type="number" id="updateSandalyeValue" min="0" value="0"><p></p>
                <button id = "guncelleSandalye">Güncelle</button>
                
                </div>
              <div class="col-md-6 themed-grid-col">
                <p id="adetValue2" style="color: rgb(0, 0, 0); font-size: 16px;"></p>
                <h6>Güncellenmek istenen sayı:</h6>
                  <input type="number" id="updateMasaValue" min="0" value="0"><p></p>
                <button id = "guncelleMasa">Güncelle</button>
              </div>
              <div class="col-md-3 themed-grid-col"><h6 style="font-size: 20px; margin-right: 200px; margin-top: 1px;">BÜTÜN İŞLEMLERİ SİL</h6>
                <button id="silButton" style="width: 100px; height: 40px; margin-top: 30px; margin-right: 200px;">ONAYLA</button></div>
            </div>
          </div>
        </div>
      </div>
    </div>

        

	<script src="js/jquery.min.js"></script>
  <script src="js/popper.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/main.js"></script>
  <script type="module">
	import { initializeApp } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-app.js";
	import { getFirestore, doc, getDoc, getDocs, collection, query , where, updateDoc,arrayUnion, arrayRemove, setDoc, deleteDoc} from "https://www.gstatic.com/firebasejs/9.4.0/firebase-firestore.js";
  import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-auth.js";

 const firebaseConfig = {
	 apiKey: "AIzaSyDenol5uVp5yDBBnUCNTonO9cQUU-trWF8",
	 authDomain: "kartepebelediye.firebaseapp.com",
	 projectId: "kartepebelediye",
	 storageBucket: "kartepebelediye.appspot.com",
	 messagingSenderId: "993270259189",
	 appId: "1:993270259189:web:9f2c893c694f1d768b14bc",
 };

 const app = initializeApp(firebaseConfig);
 const auth = getAuth(app);
 const db = getFirestore(app);

 auth.onAuthStateChanged(function (user) {
    if (user) {
      console.log(user);
    } else {
      window.location.href = 'login.html';
    }
  });

 function addRowToTable(data) {
  const tableBody = document.getElementById("table-body");
  const row = document.createElement("tr");
  row.className = "bg-success"; 

  const rowData = [
    data.isim,
    data.tc,
    data.telefon,
    data.toplamucret,
    data.alinansandalye,
    data.alinanmasa,
    data.adres,
  ];

  rowData.forEach((cellData) => {
    const cell = document.createElement("td");
    cell.textContent = cellData;
    row.appendChild(cell);
  });

  tableBody.appendChild(row);
}



function addRowToTable2(data) {
  const tableBody = document.getElementById("table-body2");
  const row = document.createElement("tr");
  row.className = "bg-primary"; 


  const rowData = [
    data.isim, 
    data.alinansandalye,
    data.alinanmasa,
    data.gerialinanmasa || "",
    data.gerialinansandalye || "",
	  data.buton || "",
  ];
  
  

  rowData.forEach((cellData, index) => {
  const cell = document.createElement("td");
  if (index === 3) {
    const inputElement = document.createElement("input");
    inputElement.type = "number";
    inputElement.min = 0;
    inputElement.max = data.alinanmasa;
    inputElement.value = cellData;
    inputElement.id = "masa"+ "-" +data.tc; // 3. indeksteki inputa "alinan-masa" id'si atanıyor
    cell.appendChild(inputElement);
  } else if (index === 4) {
    const inputElement = document.createElement("input");
    inputElement.type = "number";
    inputElement.min = 0;
    inputElement.max = data.alinansandalye;
    inputElement.value = cellData;
    inputElement.id = "sandalye"+ "-" +data.tc; // 4. indeksteki inputa "alinan-sandalye" id'si atanıyor
    cell.appendChild(inputElement);
  } else if (index === 5) {
    const button = document.createElement("button");
    button.textContent = "ONAYLA";
    button.id = data.tc;
    button.addEventListener("click", async() => {
		const sayi = doc(db, "bilgi", "adet");
		const docSnap = await getDoc(sayi);

		const masa = docSnap.data().masa;
        const sandalye = docSnap.data().sandalye;

		const masaInput = document.getElementById("masa"+ "-" +data.tc);
		const masaValue = parseInt(masaInput.value, 10);
        const sandalyeInput = document.getElementById("sandalye" + "-" + data.tc);
        const sandalyeValue = parseInt(sandalyeInput.value, 10);

		await setDoc(doc(db, "bilgi", "adet"), {
			masa: masa + masaValue,
			sandalye: sandalye + sandalyeValue,     
		});

    await setDoc(doc(db, "gecmis-islemler", data.tc), {
    isim: data.isim,
    soyisim: data.tc,
    telefon: data.telefon,
    toplamucret: data.toplamucret,
    alinansandalye: data.alinansandalye,
    alinanmasa: data.alinanmasa,
    adres: data.adres,
});
await deleteDoc(doc(db, "kullanicilar", data.tc));
location.reload();
      });
    cell.appendChild(button);
  } else {
    cell.textContent = cellData;
  }
  row.appendChild(cell);
});
  tableBody.appendChild(row);
}

function addRowToTable3(data) {
  const tableBody = document.getElementById("table-body3");
  const row = document.createElement("tr");
  row.className = "bg-warning"; // Eğer satırın arkaplan rengini değiştirmek istiyorsanız, burayı düzenleyebilirsiniz.

  const rowData = [
    data.isim,
    data.tc,
    data.telefon,
    data.toplamucret,
    data.alinansandalye,
    data.alinanmasa,
    data.adres,
    
  ];

  rowData.forEach((cellData) => {
    const cell = document.createElement("td");    
    cell.textContent = cellData;
    row.appendChild(cell);
    
  });

  tableBody.appendChild(row);
}

function addRowToTable4(data) {
  const tableBody = document.getElementById("table-body4");
  const row = document.createElement("tr");
  row.className = "bg-danger"; // Eğer satırın arkaplan rengini değiştirmek istiyorsanız, burayı düzenleyebilirsiniz.

  const rowData = [
    data.isim,
    data.tc,
    data.telefon,
    data.toplamucret,
    data.alinansandalye,
    data.alinanmasa,
    data.adres,
    data.buton || "",
  ];

  rowData.forEach((cellData,index) => {
    const cell = document.createElement("td");
     if (index === 7) {
    const button = document.createElement("button");
    button.textContent = "ÖDEME YAPILDI";
    button.id = data.tc;
    button.addEventListener("click", async() => {

    await setDoc(doc(db, "kullanicilar", data.tc), {
    isim: data.isim,
    soyisim: data.tc,
    telefon: data.telefon,
    toplamucret: data.toplamucret,
    alinansandalye: data.alinansandalye,
    alinanmasa: data.alinanmasa,
    adres: data.adres,
});
await deleteDoc(doc(db, "kullanicilar-odemesiz", data.tc)); 
location.reload();
      });
    cell.appendChild(button);
  } else {
    cell.textContent = cellData;
  }
  row.appendChild(cell);
});

  tableBody.appendChild(row);
}
async function getDataAndPopulateTable() {
  const querySnapshot = await getDocs(collection(db, "kullanicilar"));
  querySnapshot.forEach((doc) => {
    const data = doc.data();
    addRowToTable(data);
    addRowToTable2(data);

  });
}

async function getDataAndPopulateTable2() {
  const querySnapshot = await getDocs(collection(db, "gecmis-islemler"));
  querySnapshot.forEach((doc) => {
    const data = doc.data();
    addRowToTable3(data);

	
  });
}

async function getDataAndPopulateTable3() {
  const querySnapshot = await getDocs(collection(db, "kullanicilar-odemesiz"));
  querySnapshot.forEach((doc) => {
    const data = doc.data();
    addRowToTable4(data);

	
  });
}



getDataAndPopulateTable();
getDataAndPopulateTable2();
getDataAndPopulateTable3();

const sandalyeButton = document.getElementById("guncelleSandalye");
const masaButton = document.getElementById("guncelleMasa");

sandalyeButton.addEventListener("click", async function(event) {
  event.preventDefault(); 
  const newSandalyeInput = document.getElementById("updateSandalyeValue");
  const newSandalyeValue = newSandalyeInput.value;

  

const adetler = doc(db, "bilgi", "adet");
const docSnap2 = await getDoc(adetler);
                if (docSnap2.exists()) {

                    await updateDoc(adetler, {
                        sandalye: newSandalyeValue,
                    });
};
});
masaButton.addEventListener("click", async function(event) {
  event.preventDefault(); 
  const newMasaInput = document.getElementById("updateMasaValue");
  const newMasaValue = newMasaInput.value;


const adetler = doc(db, "bilgi", "adet");
const docSnap2 = await getDoc(adetler);
                if (docSnap2.exists()) {
 
                    await updateDoc(adetler, {
                        masa: newMasaValue,
                    });
};
});

async function updateAdetValue() {
                const sayi_ = doc(db, "bilgi", "adet");

                const docSnap2 = await getDoc(sayi_); 
                if (docSnap2.exists()) {
                    const masa = docSnap2.data().masa;
                    const sandalye = docSnap2.data().sandalye;
                    
                    const adetValueElement = document.getElementById("adetValue");
                    adetValueElement.textContent = `Depodaki Mevcut Sandalye: ${sandalye}`;

                    const adetValueElement2 = document.getElementById("adetValue2");
                    adetValueElement2.textContent = `Depodaki Mevcut Masa: ${masa}`;
                } else {
                    console.log("No such document!");
                }
            }
            updateAdetValue();
            

    const sButton = document.getElementById("silButton");
    const querySnapshot = await getDocs(collection(db, "kullanicilar"));
    const querySnapshot2 = await getDocs(collection(db, "gecmis-islemler"));
    const querySnapshot3 = await getDocs(collection(db, "kullanicilar-odemesiz"));
    sButton.addEventListener("click", async function(event) {
      querySnapshot.forEach(async (doc) => {
      const docRef = doc.ref;
      await deleteDoc(docRef);
  });
  querySnapshot2.forEach(async (doc) => {
      const docRef = doc.ref;
      await deleteDoc(docRef);
  });
  querySnapshot3.forEach(async (doc) => {
      const docRef = doc.ref;
      await deleteDoc(docRef);
  });
  location.reload();
  });


  
 </script>


	</body>
</html>
<!--
	const docSnap2 = await getDoc(sayi_);
                if (docSnap2.exists()) {
                    const masa = docSnap2.data().masa;

                    const yeniAdet = masa - azaltAdet;

                    if (yeniAdet < 0) {
                        alert("Lütfen geçerli bir sayı giriniz.!");
                        return;
                    }

                    // Veritabanına güncellenmiş değeri kaydedin
                    await updateDoc(sayi_, {
                        masa: yeniAdet
                    });
-->
